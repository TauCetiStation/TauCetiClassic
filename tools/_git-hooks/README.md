# Git Integration Hooks

В данной папке содержатся скрипты для инициализации [гит хуков] и [мерж драйверов].
Их использование опционально, поэтому для работы необходимо произвести установку.

Для этого нужно запустить `_install.sh` скрипт.

## Текущие хуки

* **pre-commit**: Запускает [JTGMerge] для изменённых файлов. Уменьшает финальный дифф изменений, конвертирует в TGM, делает прочие чистки.
* **Dmi merger**: Производит автоматическое разрешение конфликтов для `.dmi` файлов.
* **Dmm merger**: В случае возникновения конфликтов в `.dmm` файлах позволяет разрешить их в интерактивном режиме.

## Как добавить новый хук

Чтобы создать новый [гит хук], нужно в текущей папке создать файл и назвать его `<имя-хука>.hook`.
Файл должен содержать исполняемый код, который будет запущен при активации хука.

Новый [мерж драйвер] можно добавить путём создания файла с именем `<расширение>.merge`
и добавлением в `.gitattributes` (файл находится в корне проекта) следующей строчки `*.<расширение> merge=merge-<расширение>`.
В самом файле первая строка - имя драйвера, вторая - путь до исполняемого скрипта. В случае если необходимо запускать разные скрипты для разных ОС, можно во второй строке вместо указания конкретного расширения скрипта вставить {OS_EXT}, который будет заменён на `bat` для Windows и `sh` для всего остального. Например: `./tools/dmm-merge-tool/scripts/mapmerge.{OS_EXT} %O %A %B`

После добавления хука или драйвера необходимо повторно запустить `install` скрипт.

[гит хуков]: https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks
[гит хук]: https://git-scm.com/book/en/v2/Customizing-Git-Git-Hooks
[мерж драйверов]: https://git-scm.com/docs/gitattributes#_performing_a_three_way_merge
[мерж драйвер]: https://git-scm.com/docs/gitattributes#_performing_a_three_way_merge
[JTGMerge]: ../dmm-merge-tool/README.md
